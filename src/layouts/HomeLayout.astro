---
import RootLayout from "./RootLayout.astro";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import chunk from "lodash.chunk";
import { config } from "~shared";

export interface Props {
  currentPage: number;
}

const data = await getCollection("blog");

const chunks = chunk(data, config.blogs.chunks.size);

const { currentPage } = Astro.props;

const blogs = chunks[currentPage - 1]!;
---

<RootLayout>
  <main class:list={["py-8 sm:py-4"]}>
    <h1
      class="text-6xl md:text-8xl font-display max-h-24 font-bold text-center lg:text-left"
    >
      <span class="sr-only">Krish Gupta's</span>ARTICLES
    </h1>
    <main
      class:list={[
        "mt-8 mb-16",
        "flex flex-wrap",
        "justify-center lg:justify-start items-stretch",
      ]}
    >
      {
        blogs.map((blog, index) => (
          <article class="flex flex-col flex-grow border max-w-sm gap-2 p-4 border-black/10 dark:border-white/10">
            <Image
              src={blog.data.cover}
              densities={[0.5, 1, 2]}
              alt={blog.data.title}
              width="350"
              class="mb-2"
              loading={
                blogs.length - config.blogs.priority < index ? "eager" : "lazy"
              }
              fetchpriority={
                blogs.length - config.blogs.priority < index ? "high" : "low"
              }
            />
            <a
              href={new URL(blog.id, Astro.url)}
              class="hover:underline underline-offset-8 mb-2"
            >
              <h2 class="text-2xl font-semibold">{blog.data.title}</h2>
            </a>
            <p class="text-sm text-black/70 dark:text-white/70">
              {blog.data.date.toLocaleDateString("en-IN", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })}
            </p>
            <p class="mt-2 text-sm max-w-prose flex-grow">
              {blog.data.description}
            </p>
            <a
              href={new URL(blog.id, Astro.url)}
              class="mt-4 hover:underline underline-offset-8 mb-2"
            >
              Read More &rarr;
            </a>
          </article>
        ))
      }
    </main>
    {
      chunks.length > 1 ? (
        <footer class:list={["mx-auto mb-12", "lg:mx-0"]}>
          <nav class="flex justify-center gap-4">
            {chunks.map((_, index) => (
              <a
                href={new URL(index === 0 ? "/" : `/${index + 1}`, Astro.site)}
                class:list={[
                  "px-4 py-2",
                  "border border-black/10 dark:border-white/10",
                  "hover:bg-black/10 dark:hover:bg-white/10",
                  currentPage === index + 1
                    ? "bg-black/10 dark:bg-white/10 pointer-events-none"
                    : "",
                ]}
              >
                {index + 1}
              </a>
            ))}
          </nav>
        </footer>
      ) : null
    }
  </main>
</RootLayout>
