---
import { site } from "~shared";
import GitHubIcon from "./icons/GitHubIcon.astro";
import InstagramIcon from "./icons/InstagramIcon.astro";
import MenuIcon from "./icons/MenuIcon.astro";
import TwitterIcon from "./icons/TwitterIcon.astro";
import XIcon from "./icons/XIcon.astro";

const items: Array<
  | {
      type: "link";
      text: string;
      href: string;
      external?: boolean;
      mobileOnly?: boolean;
    }
  | {
      type: "separator";
    }
> = [
  {
    type: "link",
    text: "Home",
    href: site.toString(),
    mobileOnly: true,
  },
  {
    type: "link",
    text: "Portfolio",
    href: "https://krishg.com",
    external: true,
  },
  { type: "separator" },
];

const socials: {
  icon: typeof TwitterIcon;
  href: string;
  text: string;
}[] = [
  {
    icon: TwitterIcon,
    href: "https://x.com/kkrishguptaa",
    text: "Twitter",
  },
  {
    icon: GitHubIcon,
    href: "https://github.com/kkrishguptaa",
    text: "GitHub",
  },
  {
    icon: InstagramIcon,
    href: "https://instagram.com/kkrishguptaa",
    text: "Instagram",
  },
];
---

<header
  class:list={[
    "flex items-end justify-between",
    "py-2 sm:py-4",
    "font-display",
    "border-b border-black/30 dark:border-white/30",
    "h-14 md:h-max",
  ]}
>
  <a href={site.toString()} class:list={["hover:underline underline-offset-8"]}>
    <h2 class:list={["text-2xl"]}>Krish Gupta</h2>
  </a>
  <nav class:list={["hidden md:block"]}>
    <ul class:list={["flex items-center gap-2"]}>
      {
        items
          .filter((item) => item.type === "separator" || !item.mobileOnly)
          .map((item) => {
            if (item.type === "link") {
              return (
                <li>
                  <a
                    href={item.href}
                    target={item.external ? "_blank" : undefined}
                    class:list={["hover:underline underline-offset-8"]}
                  >
                    {item.text}
                  </a>
                </li>
              );
            } else {
              return (
                <li>
                  <span>â€”</span>
                </li>
              );
            }
          })
      }
      {
        socials.map((social) => (
          <li class:list={["mx-1"]}>
            <a
              href={social.href}
              target="_blank"
              rel="noopener noreferrer"
              class:list={["hover:opacity-70"]}
            >
              <social.icon height={16} width={16} />
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
  <button
    id="menu-button"
    class:list={[
      "md:hidden",
      "hover:rotate-180 transition-transform duration-600",
      "cursor-pointer",
      "mb-0.5",
    ]}
  >
    <MenuIcon id="menu-icon" />
    <XIcon
      id="close-icon"
      style={{
        display: "none",
      }}
    />
  </button>
</header>

<aside
  id="mobile-menu"
  class:list={[
    "md:hidden",
    "fixed top-14 left-0 right-0",
    "h-[calc(100dvh-(var(--spacing)*14))] w-screen",
    "container mx-auto px-4",
    "transform-gpu transition-transform duration-300",
    "z-50",
    "overflow-hidden",
    "translate-x-[100vw]",
  ]}
  style={{
    translate: "100vw 0",
  }}
>
  <nav
    class:list={[
      "bg-white dark:bg-black",
      "h-full w-full",
      "flex flex-col justify-center items-start text-2xl",
      "gap-8",
    ]}
  >
    {
      items
        .filter((item) => item.type === "link")
        .map((item) => (
          <a
            href={item.href}
            target={item.external ? "_blank" : undefined}
            class:list={["underline underline-offset-8 mb-2"]}
          >
            {item.text}
          </a>
        ))
    }

    <ul class:list={["flex items-center gap-4 mt-4"]}>
      {
        socials.map((social) => (
          <li>
            <a href={social.href} target="_blank" rel="noopener noreferrer">
              <social.icon height={24} width={24} />
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</aside>

<script>
  const button = document.getElementById("menu-button")!;
  const menu = document.getElementById("mobile-menu")!;
  const menuIcon = document.getElementById("menu-icon")!;
  const closeIcon = document.getElementById("close-icon")!;

  let mobileMenuOpen = false;

  button.addEventListener("click", () => {
    mobileMenuOpen = !mobileMenuOpen;
    if (mobileMenuOpen) {
      menu.style.translate = "0 0";
      menuIcon.style.display = "none";
      closeIcon.style.display = "block";
    } else {
      menu.style.translate = "100vw 0";
      menuIcon.style.display = "block";
      closeIcon.style.display = "none";
    }
  });
</script>
